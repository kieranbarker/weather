var showWeather=function(options){"use strict";var defaults={apiKey:null,selector:"#app",units:"M",message:"Right now in {city_name}, it's {temp} and {description}.",icon:true,error:"Sorry, there was a problem getting the weather. Please try again later."};var settings=Object.assign(defaults,options);var app=document.querySelector(settings.selector);function sanitizeHTML(str){var temp=document.createElement("div");temp.textContent=str;return temp.innerHTML}function getJSON(response){return response.ok?response.json():Promise.reject(response)}function getData(url){return fetch(url).then(getJSON)}function getIcon(data){var icon="";if(settings.icon){icon+="<img src='https://www.weatherbit.io/static/img/icons/"+sanitizeHTML(data.weather.icon)+".png' alt='"+sanitizeHTML(data.weather.description)+"'>"}return icon}function getUnits(unitsSetting){unitsSetting=unitsSetting.toLowerCase();if(unitsSetting==="m")return"C";if(unitsSetting==="i")return"F"}function getDescription(data,units){return settings.message.replace(/{[\w$-]+}/gi,(function(match){match=match.slice(1,-1);if(match in data){if(match==="temp"||match==="app_temp"){return sanitizeHTML(data[match])+"&deg;"+units}return sanitizeHTML(data[match])}if(match in data.weather){if(match==="description"){return sanitizeHTML(data["weather"][match]).toLowerCase()}return sanitizeHTML(data["weather"][match])}}))}function insertData(data){var icon,units;data=data["data"][0];console.dir(data);icon=getIcon(data);units=getUnits(settings.units);app.innerHTML=icon+"<p>"+getDescription(data,units)+"</p>"}function getWeather(data){return getData("https://api.weatherbit.io/v2.0/current"+"?key="+settings.apiKey+"&units="+settings.units.toUpperCase()+"&city="+data.city+"&country="+data.country)}function insertError(error){console.error(error);app.innerHTML="<p>"+settings.error+"</p>"}if(!settings.apiKey){console.error("Please provide an API key.");return}getData("https://ipapi.co/json").then(getWeather).then(insertData).catch(insertError)};